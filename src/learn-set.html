<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Better Technikinformatyk</title>
    <link rel="stylesheet" href="./styles.css">
  </head>

  <body class="min-h-screen w-full bg-stone-900">
    <div class="absolute top-5 left-5 text-3xl text-neutral-200 cursor-pointer rounded-xl hover:bg-stone-800 py-5 px-6" id="go-back-arrow">&larr;</div>

    <div class="w-full max-w-lg sm:max-w-xl lg:max-w-3xl min-h-screen p-4 flex flex-col items-center justify-center mx-auto gap-8" id="question-container">
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/vanjs-org/van/public/van-1.2.7.nomodule.min.js"></script>
    <script>
      const { invoke } = window.__TAURI__;
      const {code, button, div, p, input, label, pre, img} = van.tags;

      // back arrow
      const goBackArrow = document.querySelector("#go-back-arrow");

      goBackArrow.addEventListener("click", () => {
        window.location.href = "/";
      });

      // question
      let index = 0;
      let questionCount;

      const generateQuestion = (question, questionCode, image, answers) => {
        return div(
          { class: "w-full flex flex-col gap-2" },

          p({ class: "text-neutral-200 text-xl font-bold" }, question),

          ...[questionCode !== null ? code(
                { class: "text-neutral-400 p-4 rounded-xl bg-stone-800 overflow-x-scroll" },
            pre({ innerHTML: questionCode })
          ) : ""],

          ...[image !== null ? img({ src: image }) : ""],

          ...answers.map((answer, idx) => div(
            { class: "flex flex-row gap-2 items-center" },
            input({ type: "radio", name: "question-answer", id: `label-${idx}`, class: "w-4 h-4" }),
            label({ class: "text-neutral-200", for: `label-${idx}` }, answer)
          )),
          div(
            { class: "flex flex-row justify-end" },
            button({ 
              class: "px-8 py-2 text-neutral-200 font-semibold bg-blue-800 hover:bg-blue-700 duration-300 flex justify-center items-center rounded-xl",
              onclick: () => {
                index++;
                renderQuestion();
              }
            }, "NastÄ™pne")
          )
        );
      };

      const renderQuestion = () => {
        return invoke('get_question_from_state_by_index', { index })
          .then(question => {
            const container = document.querySelector("#question-container");
            container.innerHTML = "";
            container.appendChild(generateQuestion(question.question, question.code, question.image, question.answers));
          });
      }

      const getQuestionCount = async () => {
        return invoke('get_question_count_from_state');
      }

      window.addEventListener("DOMContentLoaded", async () => {
        questionCount = await getQuestionCount();
        await renderQuestion();
      });
    </script>
</html>
